<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>prof.syn Display</title>
  <style>
    body {
      background-color: #1f1f1f;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .logo-bar {
      width: 100%;
      display: flex;
      align-items: flex-start;
      padding: 20px 40px;
      box-sizing: border-box;
      position: absolute;
      top: 0; left: 0;
    }

    .logo { height: 150px; }

    .title {
      margin-top: 100px;
      font-size: 4.5em;
      font-weight: bold;
      color: white;
    }

    #number {
      margin-top: 4vh;
      font-size: min(50vw, 50vh);
      font-weight: bold;
      line-height: 1;
      white-space: nowrap;
    }

    /* üéâ Fanfare Styles (1k steps) */
    #fanfare {
      position: absolute;
      top: 20%; left: 0; width: 100%;
      text-align: center; display: none; z-index: 100;
    }
    .fanfare-text {
      font-size: 2.5em; color: gold; font-weight: bold;
      text-shadow: 2px 2px 8px black; margin-bottom: 0.5em;
    }
    .shout-text {
      font-size: 12em; color: #b362ff; font-weight: bold;
      text-shadow: 2px 2px 10px black; animation: swirl 60s linear infinite;
      margin-bottom: 1em; position: relative; display: inline-block;
    }
    .rocket { font-size: 3em; position: absolute; animation: floatRocket 3s ease-in-out infinite; }
    .rocket-left { left: 10%; top: 90%; }
    .rocket-right { right: 10%; top: 90%; }
    @keyframes floatRocket {
      0% { transform: translateY(0) rotate(0deg); opacity: .8; }
      50% { transform: translateY(-60vh) rotate(20deg); opacity: 1; }
      100% { transform: translateY(0) rotate(0deg); opacity: .8; }
    }
    @keyframes swirl {
      0% { transform: translate(0,0) rotate(0deg); }
      25% { transform: translate(20px,-10px) rotate(5deg); }
      50% { transform: translate(0,10px) rotate(-5deg); }
      75% { transform: translate(-20px,-10px) rotate(5deg); }
      100% { transform: translate(0,0) rotate(0deg); }
    }

    /* ===== Mega Fanfare Overlay (10k only, CSS-only fireworks) ===== */
    #megaFanfare{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center;
      z-index:200; background:radial-gradient(ellipse at center,rgba(0,0,0,.7),rgba(0,0,0,.9));
      backdrop-filter:blur(2px);
    }
    #megaFanfare.show{display:flex;}
    .mega-content{ text-align:center; animation:mf-pop .5s ease-out both; }
    .mega-title{
      font-size:clamp(3rem,10vw,10rem); font-weight:900; color:#fff;
      text-shadow:0 0 18px rgba(0,0,0,.6);
    }
    .mega-sub{ margin-top:.2em; font-size:clamp(1.5rem,5vw,4rem); font-weight:800; }
    .mega-note{ margin-top:.6em; opacity:.9; }
    @keyframes mf-pop{ from{ transform:scale(.95); opacity:0; } to{ transform:scale(1); opacity:1; } }

    /* CSS-only fireworks: each .fw creates many sparks using box-shadow */
    .fw{
      position:fixed; width:6px; height:6px; border-radius:50%; left:50%; top:50%;
      transform:translate(-50%,-50%); pointer-events:none; mix-blend-mode:screen; opacity:0;
    }
    @keyframes fw-burst{
      0%   { transform:translate(var(--x,-50%),var(--y,-50%)) scale(0); opacity:0; }
      5%   { opacity:1; }
      60%  { opacity:1; }
      100% { transform:translate(var(--x,-50%),var(--y,-50%)) scale(1.8); opacity:0; }
    }
    .fw-a{ --x:-50%; --y:-40%; animation: fw-burst 1.8s ease-out .1s both; }
    .fw-b{ --x:-20%; --y:-55%; animation: fw-burst 1.9s ease-out .6s both; }
    .fw-c{ --x:-75%; --y:-48%; animation: fw-burst 2.0s ease-out 1.1s both; }

    .fw, .fw::before, .fw::after{
      content:""; position:absolute; inset:0; border-radius:50%;
      box-shadow:
        0 -60px #ffd700, 52px -30px #ff69b4, 60px 0 #7df9ff, 40px 40px #adff2f,
        0 60px #ffa500, -45px 35px #b362ff, -60px 0 #00e676, -45px -35px #ff69b4,
        25px -45px #ffd700, 45px 25px #7df9ff, -25px 45px #adff2f, -45px -25px #ffa500;
      filter: blur(.2px);
    }
    .fw::before{ transform:scale(.8) rotate(15deg); opacity:.9; }
    .fw::after { transform:scale(1.15) rotate(-10deg); opacity:.85; }

    /* Light confetti touch (10 pieces) */
    .confetti-slim{ position:fixed; inset:0; pointer-events:none; }
    .confetti-slim span{
      position:absolute; width:8px; height:12px; opacity:.95; top:-10%;
      background: currentColor; border-radius:2px;
      animation: confetti-fall 2.8s linear both;
    }
    .confetti-slim span:nth-child(1){ left:10%; color:#ffd700; animation-delay:.1s; }
    .confetti-slim span:nth-child(2){ left:20%; color:#ff69b4; animation-delay:.2s; }
    .confetti-slim span:nth-child(3){ left:30%; color:#7df9ff; animation-delay:.3s; }
    .confetti-slim span:nth-child(4){ left:40%; color:#adff2f; animation-delay:.4s; }
    .confetti-slim span:nth-child(5){ left:50%; color:#b362ff; animation-delay:.5s; }
    .confetti-slim span:nth-child(6){ left:60%; color:#ffa500; animation-delay:.2s; }
    .confetti-slim span:nth-child(7){ left:70%; color:#00e676; animation-delay:.4s; }
    .confetti-slim span:nth-child(8){ left:80%; color:#ffd700; animation-delay:.6s; }
    .confetti-slim span:nth-child(9){ left:25%; color:#7df9ff; animation-delay:.8s; }
    .confetti-slim span:nth-child(10){ left:75%; color:#ff69b4; animation-delay:1s; }
    @keyframes confetti-fall{
      0%{ transform:translateY(0) rotate(0); }
      100%{ transform:translateY(115vh) rotate(540deg); }
    }

    /* tiny corner note */
    .corner-note{ position:fixed; right:14px; bottom:10px; font-size:12px; opacity:.75; user-select:none; }
  </style>
</head>
<body>
  <div class="logo-bar">
    <img src="logo.png" alt="prof.syn logo" class="logo" />
  </div>

  <div class="title">Antal syn</div>
  <div id="number">Loading...</div>

  <!-- üéâ Fanfare Elements -->
  <div id="fanfare">
    <div class="fanfare-text">üéâ MILESTONE! üéâ</div>
    <div class="shout-text">VI DE BEDSTE!</div>
    <div class="rocket rocket-left">üöÄ</div>
    <div class="rocket rocket-right">üöÄ</div>
  </div>

  <!-- üéä Mega Fanfare (10,000 only) ‚Äî compact -->
  <div id="megaFanfare" aria-hidden="true">
    <div class="mega-content">
      <div class="mega-title">üéä 10,000! üéä</div>
      <div class="mega-sub">VI ER DE BEDSTE!</div>
      <div class="mega-note">Tak for at hj√¶lpe os n√• denne milep√¶l ‚ù§Ô∏è</div>
    </div>

    <!-- CSS-only fireworks: a few timed bursts -->
    <div class="fw fw-a"></div>
    <div class="fw fw-b"></div>
    <div class="fw fw-c"></div>

    <!-- optional light confetti -->
    <div class="confetti-slim">
      <span></span><span></span><span></span><span></span><span></span>
      <span></span><span></span><span></span><span></span><span></span>
    </div>

    <!-- tiny corner note -->
    <div class="corner-note" aria-hidden="true">Albert er en stjerne ‚≠ê</div>
  </div>

<script>
  let lastValue = null;
  let lastCelebrated = null;
  let fanfareActive = false;

  async function fetchNumberWithRetries(maxRetries = 3, delay = 2000) {
    let attempt = 0;
    while (attempt < maxRetries) {
      try {
        const res = await fetch(`/api/getNumber?_=${Date.now()}`);
        if (!res.ok) throw new Error(`Status ${res.status}`);
        const data = await res.json();
        const newValue = parseInt(data?.number, 10);
        if (isNaN(newValue)) throw new Error("Invalid number");

        if (lastValue === null) {
          document.getElementById("number").innerText = newValue.toLocaleString();
          lastValue = newValue;
          return;
        }
        if (newValue !== lastValue) {
          animateNumberSmooth(lastValue, newValue, 900); // fast, single RAF tween
          lastValue = newValue;
        }
        return;
      } catch {
        attempt++;
        if (attempt >= maxRetries) {
          document.getElementById("number").innerText = "Error fetching";
          return;
        }
        await new Promise(r => setTimeout(r, delay));
      }
    }
  }

  // Smooth, lightweight number tween (avoids thousands of setInterval ticks)
  function animateNumberSmooth(from, to, durationMs = 800) {
    const el = document.getElementById("number");
    const start = performance.now();
    const delta = to - from;
    const format = n => n.toLocaleString();

    function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

    function frame(t) {
      const p = Math.min(1, (t - start) / durationMs);
      const eased = easeOutCubic(p);
      const val = Math.round(from + delta * eased);
      el.innerText = format(val);
      if (p < 1) requestAnimationFrame(frame);
      else checkForMilestone(from, to);
    }
    requestAnimationFrame(frame);
  }

  function checkForMilestone(from, to) {
    const fromMilestone = Math.floor(from / 1000);
    const toMilestone   = Math.floor(to / 1000);
    if (toMilestone > fromMilestone) {
      const milestoneValue = toMilestone * 1000;
      if (lastCelebrated === milestoneValue) return;
      lastCelebrated = milestoneValue;

      if (!fanfareActive) {
        if (milestoneValue === 10000) triggerMegaFanfare(milestoneValue);
        else triggerFanfare(milestoneValue);
      }
    }
  }

  function triggerFanfare(milestone) {
    fanfareActive = true;
    const fanfare = document.getElementById("fanfare");
    fanfare.style.display = "block";
    fanfare.querySelector(".fanfare-text").innerText =
      `üéâ ${milestone.toLocaleString()} MILESTONE! üéâ`;
    setTimeout(() => { fanfare.style.display = "none"; fanfareActive = false; }, 60000);
  }

  function triggerMegaFanfare(milestone){
    fanfareActive = true;
    const overlay = document.getElementById('megaFanfare');
    overlay.querySelector('.mega-title').textContent =
      `üéä ${milestone.toLocaleString()}! üéä`;
    overlay.classList.add('show');
    setTimeout(() => {
      overlay.classList.remove('show');
      fanfareActive = false;
    }, 10000); // short + light
  }

  // Initial fetch + interval loop
  fetchNumberWithRetries();
  setInterval(fetchNumberWithRetries, 10000);

  // Re-fetch on tab visibility change
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "visible") fetchNumberWithRetries();
  });
</script>

</body>
</html>
